# Migration Guide: v1.3.0 ‚Üí v1.6.0

**AgentDB v1.6.0** is a **drop-in replacement** for v1.3.0 with zero breaking changes. All existing code will continue to work without modification.

---

## Quick Start

### Installation

```bash
npm install agentdb@1.6.0
```

That's it! No code changes required.

---

## What's New

### 1. Direct Vector Search (NEW)

Perform raw vector similarity queries without semantic processing.

```bash
# CLI usage
agentdb vector-search ./my-db.db '[0.1,0.2,...]' -k 10 -m cosine

# With MMR diversity ranking
agentdb vector-search ./my-db.db '[0.1,0.2,...]' -k 10 --mmr 0.5
```

**JavaScript API**:
```javascript
import { MMRDiversityRanker } from 'agentdb/controllers/MMRDiversityRanker';

// Select diverse results
const diverse = MMRDiversityRanker.selectDiverse(
  candidates,
  queryEmbedding,
  { lambda: 0.5, k: 10, metric: 'cosine' }
);
```

### 2. Context Synthesis (NEW)

Generate intelligent summaries from multiple memories.

```bash
# CLI usage
agentdb query --domain 'coding' --query 'bug fixes' --synthesize-context
agentdb reflexion retrieve 'authentication' 10 --synthesize-context
```

**JavaScript API**:
```javascript
import { ContextSynthesizer } from 'agentdb/controllers/ContextSynthesizer';

const context = ContextSynthesizer.synthesize(memories, {
  minPatternFrequency: 2,
  includeRecommendations: true
});

console.log(context.summary);
console.log(context.keyInsights);
console.log(context.recommendations);
```

### 3. Advanced Metadata Filtering (NEW)

MongoDB-style operators for complex queries.

```bash
# CLI usage
agentdb reflexion retrieve 'optimization' 10 \
  --filters '{"success":true,"reward":{"$gte":0.9}}'
```

**JavaScript API**:
```javascript
import { MetadataFilter } from 'agentdb/controllers/MetadataFilter';

// Filter in-memory
const filtered = MetadataFilter.apply(items, {
  success: true,
  reward: { $gte: 0.9 },
  domain: { $in: ['coding', 'testing'] },
  'metadata.priority': { $exists: true }
});

// Generate SQL WHERE clause
const { where, params } = MetadataFilter.toSQL({
  success: true,
  reward: { $gte: 0.9 }
});
```

**Supported Operators**:
- `$eq`, `$ne` - Equality/inequality
- `$gt`, `$gte`, `$lt`, `$lte` - Comparisons
- `$in`, `$nin` - Array membership
- `$contains` - String/array contains
- `$exists` - Field existence

### 4. Enhanced Init Command (NEW)

More flexible database initialization.

```bash
# Custom embedding dimensions
agentdb init ./my-db.db --dimension 768

# Database presets
agentdb init ./my-db.db --preset small  # 384D
agentdb init ./my-db.db --preset medium # 768D
agentdb init ./my-db.db --preset large  # 1536D

# In-memory database (no disk persistence)
agentdb init --in-memory --dimension 1536
```

### 5. Export/Import with Compression (NEW)

```bash
# Export with gzip compression
agentdb export ./my-db.db ./backup.json --compress
# Creates: backup.json.gz

# Import with decompression
agentdb import ./backup.json.gz ./restored-db.db --decompress
```

### 6. Stats Command (NEW)

```bash
agentdb stats ./my-db.db
```

**Output**:
```
üìä AgentDB Statistics
  Episodes: 150
  Skills: 25
  Causal Edges: 42
  Embeddings: 150
  Database Size: 2.4 MB
  Top Domains: coding, testing, debugging
```

---

## Breaking Changes

**NONE** - v1.6.0 is 100% backward compatible with v1.3.0.

---

## Deprecations

**NONE** - All v1.3.0 APIs remain fully supported.

---

## Bug Fixes

### 1. Database Persistence (CRITICAL FIX)

**Issue**: Episodes and skills were not persisting to disk correctly with sql.js WASM.

**Fixed**: Added `db.save()` calls after all write operations.

**Impact**: All data now correctly persists between sessions.

**Migration**: No action required - fix is automatic.

### 2. Browser Bundle WASM Loading

**Issue**: 35 browser tests failed due to WASM path resolution issues.

**Fixed**: Environment-aware path detection with local/CDN fallback.

**Impact**: Browser bundle now works correctly in all environments.

**Migration**: No action required - fix is automatic.

### 3. Package Exports

**Issue**: New controllers not accessible via `import`.

**Fixed**: All controllers properly exported in `package.json`.

**Impact**: All controllers now importable.

**Migration**: Update imports if using direct paths:

```javascript
// Before (still works)
import { MMRDiversityRanker } from 'agentdb/dist/controllers/MMRDiversityRanker.js';

// After (recommended)
import { MMRDiversityRanker } from 'agentdb/controllers/MMRDiversityRanker';
```

---

## Performance Improvements

### Optimized sql.js WASM

- Faster database initialization
- More efficient memory usage
- Better browser performance

### Batch Operations

Transaction-based batch inserts for improved throughput.

---

## Documentation Updates

### Accurate Feature Documentation

All documentation has been updated to accurately reflect implementation status:

- ‚úÖ **Implemented features** clearly marked
- üó∫Ô∏è **Roadmap features** moved to CHANGELOG roadmap section
- ‚ö†Ô∏è **Known limitations** properly documented

### New Guides

- **CHANGELOG.md** - Complete version history
- **V1.6.0_MIGRATION.md** - This guide
- **QUIC-ARCHITECTURE.md** - Future synchronization design

---

## Testing

### Validation

All v1.6.0 features have been comprehensively tested:

- ‚úÖ 38/38 landing page features verified
- ‚úÖ Core features: 16/16 pass (100%)
- ‚úÖ New features: 11/11 pass (100%)
- ‚úÖ Advanced features: 7/7 pass (100%)
- ‚úÖ API exports: 4/4 pass (100%)

### Test Your Migration

```bash
# Run comprehensive test suite
npm test

# Run landing page verification
bash tests/landing-page-verification.sh

# Verify specific features
agentdb --version  # Should show 1.6.0
agentdb --help     # Should list new commands
```

---

## Upgrade Checklist

- [ ] Backup your existing database
- [ ] Install v1.6.0: `npm install agentdb@1.6.0`
- [ ] Run your existing tests
- [ ] Try new features (optional):
  - [ ] Vector search
  - [ ] Context synthesis
  - [ ] Metadata filtering
  - [ ] Enhanced init options
- [ ] Update documentation references

---

## Rollback

If you need to rollback to v1.3.0:

```bash
npm install agentdb@1.3.0
```

**Note**: v1.6.0 databases are forward-compatible. You can downgrade without data loss.

---

## Common Issues

### Issue: "Vector dimension mismatch"

**Cause**: Query vector dimensions don't match database embeddings.

**Solution**: Check database dimension with `agentdb stats` and match your query vectors.

```bash
# Check dimension
agentdb stats ./my-db.db | grep "Embedding Dimension"

# Use matching dimension
agentdb vector-search ./my-db.db '[...]' -k 10  # Vector must match DB dimension
```

### Issue: "Command not found: vector-search"

**Cause**: Using old AgentDB installation.

**Solution**: Clear npm cache and reinstall:

```bash
npm cache clean --force
npm install agentdb@1.6.0
```

### Issue: Browser bundle not loading

**Cause**: WASM path issues (fixed in v1.6.0).

**Solution**: Upgrade to v1.6.0 - fix is automatic.

---

## Support

- **Documentation**: `/docs` directory
- **Examples**: `/src/examples` directory
- **Tests**: `/tests` directory
- **GitHub Issues**: https://github.com/ruvnet/agentic-flow/issues
- **NPM**: https://www.npmjs.com/package/agentdb

---

## What's Next

### v1.7.0 (Planned - 8-12 weeks)

- QUIC synchronization for multi-node coordination
- Real-time distributed memory
- Advanced conflict resolution

### v2.0.0 (Future - 4-6 months)

- HNSW indexing for 10-100x performance
- Hybrid vector + keyword search
- Quantization for memory efficiency
- Comprehensive performance benchmarks

---

## Feedback

We'd love to hear about your v1.6.0 experience!

- Report issues: https://github.com/ruvnet/agentic-flow/issues
- Feature requests: https://github.com/ruvnet/agentic-flow/discussions
- Questions: Stack Overflow tag `agentdb`

---

**Migration Guide Version**: 1.0
**Last Updated**: 2025-10-25
**AgentDB Version**: 1.6.0
