FROM node:22-slim
WORKDIR /app

# Install jq for JSON processing
RUN apt-get update && apt-get install -y jq && rm -rf /var/lib/apt/lists/*

# Copy package files
COPY agentic-flow/package.json ./
COPY agentic-flow/dist ./dist
COPY agentic-flow/.claude ./.claude
COPY docker/test-agent-management.sh /test-agent-management.sh

# Install dependencies and link
RUN npm install --omit=dev && npm link

# Set up test environment
ENV ANTHROPIC_API_KEY=sk-ant-test-key-12345
ENV NODE_ENV=test

RUN chmod +x /test-agent-management.sh

CMD ["/test-agent-management.sh"]
