FROM node:22-slim

WORKDIR /app

# Copy local package
COPY package.json ./
COPY dist ./dist
COPY .claude ./.claude
COPY docs ./docs
COPY scripts ./scripts

# Install dependencies and link globally
RUN npm install --omit=dev && npm link

# Make test script executable
RUN chmod +x /app/scripts/test-all-commands.sh

# Set up environment
ENV NODE_ENV=production

# Run comprehensive tests
CMD ["/app/scripts/test-all-commands.sh"]
